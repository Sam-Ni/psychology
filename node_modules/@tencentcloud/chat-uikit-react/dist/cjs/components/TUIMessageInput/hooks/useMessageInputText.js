"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),t=require("react"),n=require("../../../constants.js"),r=require("../../../context/TUIKitContext.js");require("../../../context/TUIChatStateContext.js");var a=require("../../../context/TUIChatActionContext.js");require("../../../context/TUIMessageContext.js"),require("../../../context/ComponentContext.js"),require("../../../context/TUIMessageInputContext.js");var u=require("../../TUIMessage/utils/emojiMap.js"),o=require("./useHandleQuoteMessage.js");exports.useMessageInputText=function(s){var i=s.state,c=s.dispatch;s.focus;var T=s.textareaRef,l=s.sendUploadMessage,d=r.useTUIKitContext("useMessageInputText").tim,C=a.useTUIChatActionContext(),_=C.sendMessage,f=C.createTextMessage,S=C.operateMessage,E=o.useHandleQuoteMessage().cloudCustomData,x=["Enter","NumpadEnter"],v=t.useCallback((function(e){e.preventDefault(),e&&e.target&&c({type:n.CONSTANT_DISPATCH_TYPE.SET_TEXT,getNewText:function(t){return e.target.value}})}),[d]),p=function(t){return e.__awaiter(void 0,void 0,void 0,(function(){var r,a,o;return e.__generator(this,(function(e){switch(e.label){case 0:return null==t||t.preventDefault(),i.text?(r={payload:{text:u.formatEmojiString(i.text)}},E.messageReply&&(r.cloudCustomData=JSON.stringify(E)),a=f(r),[4,_(a)]):[2];case 1:return e.sent(),c({getNewText:function(e){return""},type:n.CONSTANT_DISPATCH_TYPE.SET_TEXT}),S(((o={})[n.MESSAGE_OPERATE.QUOTE]=null,o)),[2]}}))}))},g=t.useCallback((function(e){!(null==e?void 0:e.ctrlKey)&&x.indexOf(null==e?void 0:e.code)>-1&&13===e.keyCode&&(null==e||e.preventDefault(),p(e)),(null==e?void 0:e.ctrlKey)&&x.indexOf(null==e?void 0:e.code)>-1&&13===e.keyCode&&c({type:n.CONSTANT_DISPATCH_TYPE.SET_TEXT,getNewText:function(e){return"".concat(e,"\n")}})}),[p,c]),P=t.useCallback((function(t){return e.__awaiter(void 0,void 0,void 0,(function(){var r,a,u;return e.__generator(this,(function(e){return t.preventDefault(),t.clipboardData&&t.clipboardData.items?(r=t.clipboardData,a=r.types,u=r.items,a.find((function(e,t){var r=u[t];switch(e){case"text/plain":return r.getAsString((function(e){c({type:n.CONSTANT_DISPATCH_TYPE.SET_TEXT,getNewText:function(t){return"".concat(t).concat(e)}})})),!0;case"Files":var a=r.getAsFile();return r&&"file"===r.kind&&r.type.match(/^image\//i)&&l({file:a},n.MESSAGE_TYPE_NAME.IMAGE),!0;default:return!1}})),[2]):[2]}))}))}),[T]),A=t.useCallback((function(e){var t;c({type:n.CONSTANT_DISPATCH_TYPE.SET_TEXT,getNewText:function(t){return"".concat(t.slice(0,i.cursorPos.start)).concat(e).concat(t.slice(i.cursorPos.start))}}),c({type:n.CONSTANT_DISPATCH_TYPE.SET_CURSOR_POS,value:{start:i.cursorPos.start+e.length,end:i.cursorPos.end+e.length}}),null===(t=null==T?void 0:T.current)||void 0===t||t.focus()}),[T,i]),N=t.useCallback((function(e){var t;c({type:n.CONSTANT_DISPATCH_TYPE.SET_TEXT,getNewText:function(){return"".concat(e)}}),null===(t=null==T?void 0:T.current)||void 0===t||t.focus()}),[T]),I=t.useCallback((function(e){c({type:n.CONSTANT_DISPATCH_TYPE.SET_CURSOR_POS,value:e})}),[T]);return{handleChange:v,handleSubmit:p,handleKeyDown:g,handlePasete:P,insertText:A,setText:N,setCursorPos:I}};
