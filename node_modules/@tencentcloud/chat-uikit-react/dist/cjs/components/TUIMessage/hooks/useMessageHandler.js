"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),t=require("react"),r=require("../../../constants.js"),n=require("../../../context/TUIKitContext.js");require("../../../context/TUIChatStateContext.js");var a=require("../../../context/TUIChatActionContext.js");require("../../../context/TUIMessageContext.js"),require("../../../context/ComponentContext.js"),require("../../../context/TUIMessageInputContext.js");var s=require("../../Toast/index.js");exports.useMessageHandler=function(o){var i=o.message,u=o.handleError,l=a.useTUIChatActionContext(),c=l.removeMessage,d=l.editLocalmessage,v=l.operateMessage,f=l.revokeMessage,g=n.useTUIKitContext("useDeleteHandler").tim,p=t.useCallback((function(t){return e.__awaiter(void 0,void 0,void 0,(function(){var r;return e.__generator(this,(function(e){switch(e.label){case 0:if(t.preventDefault(),!(null==i?void 0:i.ID)||!g||!c)return[2];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,g.deleteMessage([i])];case 2:return e.sent(),c(i),[3,4];case 3:if(r=e.sent(),!u)throw s.Toast({text:"Error deleting message",type:"error"}),new Error(r);return u({functionName:"deleteMessage",error:r}),[3,4];case 4:return[2]}}))}))}),[i]),x=t.useCallback((function(t){return e.__awaiter(void 0,void 0,void 0,(function(){var n,a;return e.__generator(this,(function(e){switch(e.label){case 0:if(t.preventDefault(),!(null==i?void 0:i.ID)||!g||!d)return[2];e.label=1;case 1:return e.trys.push([1,6,,7]),f?[4,f(i)]:[3,3];case 2:return e.sent(),[3,5];case 3:return[4,g.revokeMessage(i)];case 4:e.sent(),e.label=5;case 5:return d(i),[3,7];case 6:if(n=e.sent(),!u)throw a=i.flow===r.MESSAGE_FLOW.OUT?"The message recall exceeded the time limit (default 2 minutes)":"Error revoke Message",s.Toast({text:a,type:"error"}),new Error(n);return u({functionName:"revokeMessage",error:n}),[3,7];case 7:return[2]}}))}))}),[i]),h=t.useCallback((function(e){var t;e.preventDefault(),(null==i?void 0:i.ID)&&g&&v&&v(((t={})[r.MESSAGE_OPERATE.QUOTE]=i,t))}),[i]),M=t.useCallback((function(e){if(e.preventDefault(),navigator.clipboard)navigator.clipboard.writeText(i.payload.text);else{var t=document.createElement("textarea");document.body.appendChild(t),t.style.position="fixed",t.style.clip="rect(0 0 0 0)",t.style.top="10px",t.value=i.payload.text,t.select(),document.execCommand("copy",!0),document.body.removeChild(t)}}),[i]),m=t.useCallback((function(t){return e.__awaiter(void 0,void 0,void 0,(function(){var t,r,n;return e.__generator(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,g.resendMessage(i)];case 1:return t=e.sent(),d(null===(n=null==t?void 0:t.data)||void 0===n?void 0:n.message),[3,3];case 2:if(r=e.sent(),!u)throw s.Toast({text:r,type:"error"}),new Error(r);return u({functionName:"resendMessage",error:r}),[3,3];case 3:return[2]}}))}))}),[i]),C=t.useCallback((function(t){return e.__awaiter(void 0,void 0,void 0,(function(){var n;return e.__generator(this,(function(e){return t.preventDefault(),(null==i?void 0:i.ID)&&g&&v?(v(((n={})[r.MESSAGE_OPERATE.FORWARD]=i,n)),[2]):[2]}))}))}),[i]);return{handleDelMessage:p,handleRevokeMessage:x,handleReplyMessage:h,handleCopyMessage:M,handleResendMessage:m,handleForWardMessage:C}};
