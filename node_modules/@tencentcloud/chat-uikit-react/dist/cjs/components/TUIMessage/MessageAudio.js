"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),t=require("react/jsx-runtime"),n=require("react");require("../../context/TUIKitContext.js");var r=require("../../context/TUIChatStateContext.js"),s=require("../../context/TUIChatActionContext.js");require("../../context/TUIMessageContext.js"),require("../../context/ComponentContext.js"),require("../../context/TUIMessageInputContext.js");var u=require("../Icon/Icon.js"),c=require("../Icon/type.js");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=o(n).default.memo((function(o){var a=o.context,i=o.message,l=o.children,d=s.useTUIChatActionContext().setAudioSource,x=r.useTUIChatStateContext("MessageAudioWithContext").audioSource,v=n.useState(0),f=v[0],p=v[1],j=n.useRef(null),m=n.useState(!1),C=m[0],g=m[1],I=n.useCallback((function(){x&&x!==(null==j?void 0:j.current)&&(x.pause(),x.currentTime=0,d(null)),(null==j?void 0:j.current)&&(j.current.paused?(j.current.play(),g(!0),d(j.current)):(j.current.pause(),q()))}),[j,x]),h=function(){g(!1)},q=function(){d(null),j.current.currentTime=0,h()};return n.useEffect((function(){return(null==j?void 0:j.current)&&(j.current.addEventListener("pause",h),j.current.addEventListener("ended",q),j.current.addEventListener("canplay",(function(){p(parseInt("".concat(j.current.duration),10))}))),function(){(null==j?void 0:j.current)&&(j.current.removeEventListener("pause",h),j.current.removeEventListener("ended",q))}}),[j]),t.jsxs("div",e.__assign({className:"message-audio"},{children:[t.jsxs("div",e.__assign({className:"message-audio-content message-audio-".concat(i.flow)},{children:[t.jsx(u.Icon,{className:"".concat(null==i?void 0:i.flow," ").concat(C?"playing":""),type:c.IconTypes.VOICE,width:16,height:16,onClick:I}),t.jsx("span",{children:"".concat(f,"s")})]})),t.jsx("audio",e.__assign({src:null==a?void 0:a.url,ref:j,controls:!0,className:"message-audio-none"},{children:t.jsx("track",{kind:"captions"})})),l]}))}));exports.MessageAudio=function(n){return t.jsx(a,e.__assign({},n))};
