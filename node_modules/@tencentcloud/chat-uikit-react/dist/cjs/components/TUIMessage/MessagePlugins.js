"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),s=require("react/jsx-runtime"),n=require("react"),i=require("tim-js-sdk"),o=require("../Plugins/index.js"),l=require("../Icon/Icon.js"),t=require("../Icon/type.js");require("../../context/TUIKitContext.js");var a=require("../../context/TUIChatStateContext.js");require("../../context/TUIChatActionContext.js");var r=require("../../context/TUIMessageContext.js");require("../../context/ComponentContext.js"),require("../../context/TUIMessageInputContext.js");var u=require("./hooks/useMessageHandler.js"),d=require("../../constants.js");require("date-fns");var g=require("./hooks/useMessagePluginElement.js");function c(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var h,S=c(i);!function(e){e.quote="quote",e.forward="forward",e.copy="copy",e.delete="delete",e.resend="resend",e.revoke="revoke"}(h||(h={})),exports.MessagePlugins=function(i){var c,h,p,v,M,_,m=i.plugins,T=i.showNumber,y=i.MoreIcon,x=i.config,f=n.useState(""),E=f[0],j=f[1],w=n.useRef(null),C=r.useTUIMessageContext("MessagePlugins"),I=C.message,q=C.plugin,U=a.useTUIChatStateContext("MessageBubbleWithContext").messageListRef,A=u.useMessageHandler({message:I}),N=A.handleDelMessage,P=A.handleRevokeMessage,R=A.handleReplyMessage,k=A.handleCopyMessage,b=A.handleResendMessage,G=A.handleForWardMessage,O={quote:e.__assign(e.__assign({isShow:!0},null==x?void 0:x.quote),null===(c=null==q?void 0:q.config)||void 0===c?void 0:c.quote),forward:e.__assign(e.__assign({isShow:!0},null==x?void 0:x.forward),null===(h=null==q?void 0:q.config)||void 0===h?void 0:h.forward),copy:e.__assign(e.__assign({isShow:!0,relateMessageType:[S.default.TYPES.MSG_TEXT]},null==x?void 0:x.copy),null===(p=null==q?void 0:q.config)||void 0===p?void 0:p.copy),delete:e.__assign(e.__assign({isShow:!0},null==x?void 0:x.delete),null===(v=null==q?void 0:q.config)||void 0===v?void 0:v.delete),revoke:e.__assign(e.__assign({isShow:!0},null==x?void 0:x.revoke),null===(M=null==q?void 0:q.config)||void 0===M?void 0:M.revoke),resend:e.__assign(e.__assign({isShow:!0},null==x?void 0:x.resend),null===(_=null==q?void 0:q.config)||void 0===_?void 0:_.resend)},D=g.useMessagePluginElement({children:s.jsxs("div",e.__assign({className:"message-plugin-item"},{children:[s.jsx("span",{children:"Recall"}),s.jsx(l.Icon,{width:20,height:20,type:t.IconTypes.REVOCATION})]})),handle:function(e){w.current.closeMore(),P(e)},message:I,isShow:O.revoke.isShow&&(null==I?void 0:I.status)===d.MESSAGE_STATUS.SUCCESS&&I.flow===d.MESSAGE_FLOW.OUT,relateMessageType:O.revoke.relateMessageType}),L=g.useMessagePluginElement({children:s.jsxs("div",e.__assign({className:"message-plugin-item"},{children:[s.jsx("span",e.__assign({className:"del"},{children:"Delete"})),s.jsx(l.Icon,{width:20,height:20,type:t.IconTypes.DEL})]})),handle:function(e){w.current.closeMore(),N(e)},message:I,isShow:O.delete.isShow&&(null==I?void 0:I.status)===d.MESSAGE_STATUS.SUCCESS,relateMessageType:O.delete.relateMessageType}),W=g.useMessagePluginElement({children:s.jsxs("div",e.__assign({className:"message-plugin-item"},{children:[s.jsx("span",{children:"Quote"}),s.jsx(l.Icon,{width:20,height:20,type:t.IconTypes.QUOTE})]})),handle:function(e){w.current.closeMore(),R(e)},message:I,isShow:O.quote.isShow&&(null==I?void 0:I.status)===d.MESSAGE_STATUS.SUCCESS,relateMessageType:O.quote.relateMessageType}),F=g.useMessagePluginElement({children:s.jsxs("div",e.__assign({className:"message-plugin-item"},{children:[s.jsx("span",{children:"Copy"}),s.jsx(l.Icon,{width:20,height:20,type:t.IconTypes.COPY})]})),handle:function(e){w.current.closeMore(),k(e)},message:I,isShow:O.copy.isShow&&(null==I?void 0:I.status)===d.MESSAGE_STATUS.SUCCESS,relateMessageType:O.copy.relateMessageType}),Y=g.useMessagePluginElement({children:s.jsxs("div",e.__assign({className:"message-plugin-item"},{children:[s.jsx("span",{children:"Resend"}),s.jsx(l.Icon,{width:20,height:20,type:t.IconTypes.REPLY})]})),handle:function(e){w.current.closeMore(),b(e)},message:I,isShow:O.resend.isShow&&(null==I?void 0:I.status)!==d.MESSAGE_STATUS.SUCCESS,relateMessageType:O.resend.relateMessageType}),H=[D,W,g.useMessagePluginElement({children:s.jsxs("div",e.__assign({className:"message-plugin-item"},{children:[s.jsx("span",{children:"查看合并信息"}),s.jsx(l.Icon,{width:20,height:20,type:t.IconTypes.FORWARD})]})),handle:function(e){w.current.closeMore(),G(e)},message:I,isShow:O.forward.isShow&&(null==I?void 0:I.status)===d.MESSAGE_STATUS.SUCCESS,relateMessageType:O.forward.relateMessageType}),L,Y,F],Q=(m||(null==q?void 0:q.plugins)||H).filter((function(e){return e})),V=y||(null==q?void 0:q.MoreIcon)||s.jsx(l.Icon,{className:"icon-more",width:16,height:16,type:t.IconTypes.MORE}),B=T||(null==q?void 0:q.showNumber)||0;return(null==I?void 0:I.status)!==d.MESSAGE_STATUS.UNSEND&&s.jsx(o.Plugins,{className:"message-plugin",customClass:E,ref:w,plugins:Q,showNumber:B,MoreIcon:V,root:null==U?void 0:U.current,handleVisible:function(e){j("".concat(!e.top&&"message-plugin-top"," ").concat(!e.left&&"message-plugin-left"))}})};
