import{__assign as e}from"tslib";import{jsxs as s,jsx as o}from"react/jsx-runtime";import{useState as t,useRef as n}from"react";import i from"tim-js-sdk";import{Plugins as l}from"../Plugins/index.js";import{Icon as r}from"../Icon/Icon.js";import{IconTypes as a}from"../Icon/type.js";import"../../context/TUIKitContext.js";import{useTUIChatStateContext as d}from"../../context/TUIChatStateContext.js";import"../../context/TUIChatActionContext.js";import{useTUIMessageContext as u}from"../../context/TUIMessageContext.js";import"../../context/ComponentContext.js";import"../../context/TUIMessageInputContext.js";import{useMessageHandler as c}from"./hooks/useMessageHandler.js";import{MESSAGE_STATUS as h,MESSAGE_FLOW as g}from"../../constants.js";import"date-fns";import{useMessagePluginElement as p}from"./hooks/useMessagePluginElement.js";var m;function v(m){var v,f,S,w,M,y,C=m.plugins,T=m.showNumber,x=m.MoreIcon,E=m.config,N=t(""),j=N[0],U=N[1],I=n(null),k=u("MessagePlugins"),R=k.message,b=k.plugin,q=d("MessageBubbleWithContext").messageListRef,O=c({message:R}),P=O.handleDelMessage,D=O.handleRevokeMessage,A=O.handleReplyMessage,F=O.handleCopyMessage,L=O.handleResendMessage,W=O.handleForWardMessage,Y={quote:e(e({isShow:!0},null==E?void 0:E.quote),null===(v=null==b?void 0:b.config)||void 0===v?void 0:v.quote),forward:e(e({isShow:!0},null==E?void 0:E.forward),null===(f=null==b?void 0:b.config)||void 0===f?void 0:f.forward),copy:e(e({isShow:!0,relateMessageType:[i.TYPES.MSG_TEXT]},null==E?void 0:E.copy),null===(S=null==b?void 0:b.config)||void 0===S?void 0:S.copy),delete:e(e({isShow:!0},null==E?void 0:E.delete),null===(w=null==b?void 0:b.config)||void 0===w?void 0:w.delete),revoke:e(e({isShow:!0},null==E?void 0:E.revoke),null===(M=null==b?void 0:b.config)||void 0===M?void 0:M.revoke),resend:e(e({isShow:!0},null==E?void 0:E.resend),null===(y=null==b?void 0:b.config)||void 0===y?void 0:y.resend)},Q=p({children:s("div",e({className:"message-plugin-item"},{children:[o("span",{children:"Recall"}),o(r,{width:20,height:20,type:a.REVOCATION})]})),handle:function(e){I.current.closeMore(),D(e)},message:R,isShow:Y.revoke.isShow&&(null==R?void 0:R.status)===h.SUCCESS&&R.flow===g.OUT,relateMessageType:Y.revoke.relateMessageType}),V=p({children:s("div",e({className:"message-plugin-item"},{children:[o("span",e({className:"del"},{children:"Delete"})),o(r,{width:20,height:20,type:a.DEL})]})),handle:function(e){I.current.closeMore(),P(e)},message:R,isShow:Y.delete.isShow&&(null==R?void 0:R.status)===h.SUCCESS,relateMessageType:Y.delete.relateMessageType}),B=p({children:s("div",e({className:"message-plugin-item"},{children:[o("span",{children:"Quote"}),o(r,{width:20,height:20,type:a.QUOTE})]})),handle:function(e){I.current.closeMore(),A(e)},message:R,isShow:Y.quote.isShow&&(null==R?void 0:R.status)===h.SUCCESS,relateMessageType:Y.quote.relateMessageType}),G=p({children:s("div",e({className:"message-plugin-item"},{children:[o("span",{children:"Copy"}),o(r,{width:20,height:20,type:a.COPY})]})),handle:function(e){I.current.closeMore(),F(e)},message:R,isShow:Y.copy.isShow&&(null==R?void 0:R.status)===h.SUCCESS,relateMessageType:Y.copy.relateMessageType}),H=p({children:s("div",e({className:"message-plugin-item"},{children:[o("span",{children:"Resend"}),o(r,{width:20,height:20,type:a.REPLY})]})),handle:function(e){I.current.closeMore(),L(e)},message:R,isShow:Y.resend.isShow&&(null==R?void 0:R.status)!==h.SUCCESS,relateMessageType:Y.resend.relateMessageType}),K=[Q,B,p({children:s("div",e({className:"message-plugin-item"},{children:[o("span",{children:"Forward"}),o(r,{width:20,height:20,type:a.FORWARD})]})),handle:function(e){I.current.closeMore(),W(e)},message:R,isShow:Y.forward.isShow&&(null==R?void 0:R.status)===h.SUCCESS,relateMessageType:Y.forward.relateMessageType}),V,H,G],X=(C||(null==b?void 0:b.plugins)||K).filter((function(e){return e})),_=x||(null==b?void 0:b.MoreIcon)||o(r,{className:"icon-more",width:16,height:16,type:a.MORE}),z=T||(null==b?void 0:b.showNumber)||0;return(null==R?void 0:R.status)!==h.UNSEND&&o(l,{className:"message-plugin",customClass:j,ref:I,plugins:X,showNumber:z,MoreIcon:_,root:null==q?void 0:q.current,handleVisible:function(e){U("".concat(!e.top&&"message-plugin-top"," ").concat(!e.left&&"message-plugin-left"))}})}!function(e){e.quote="quote",e.forward="forward",e.copy="copy",e.delete="delete",e.resend="resend",e.revoke="revoke"}(m||(m={}));export{v as MessagePlugins};
