import{__assign as t}from"tslib";import{jsxs as e,jsx as n}from"react/jsx-runtime";import r,{useState as o,useRef as c,useCallback as i,useEffect as u}from"react";import"../../context/TUIKitContext.js";import{useTUIChatStateContext as a}from"../../context/TUIChatStateContext.js";import{useTUIChatActionContext as s}from"../../context/TUIChatActionContext.js";import"../../context/TUIMessageContext.js";import"../../context/ComponentContext.js";import"../../context/TUIMessageInputContext.js";import{Icon as l}from"../Icon/Icon.js";import{IconTypes as d}from"../Icon/type.js";var m=r.memo((function(r){var m=r.context,p=r.message,f=r.children,v=s().setAudioSource,x=a("MessageAudioWithContext").audioSource,C=o(0),h=C[0],I=C[1],g=c(null),j=o(!1),T=j[0],E=j[1],y=i((function(){x&&x!==(null==g?void 0:g.current)&&(x.pause(),x.currentTime=0,v(null)),(null==g?void 0:g.current)&&(g.current.paused?(g.current.play(),E(!0),v(g.current)):(g.current.pause(),U()))}),[g,x]),L=function(){E(!1)},U=function(){v(null),g.current.currentTime=0,L()};return u((function(){return(null==g?void 0:g.current)&&(g.current.addEventListener("pause",L),g.current.addEventListener("ended",U),g.current.addEventListener("canplay",(function(){I(parseInt("".concat(g.current.duration),10))}))),function(){(null==g?void 0:g.current)&&(g.current.removeEventListener("pause",L),g.current.removeEventListener("ended",U))}}),[g]),e("div",t({className:"message-audio"},{children:[e("div",t({className:"message-audio-content message-audio-".concat(p.flow)},{children:[n(l,{className:"".concat(null==p?void 0:p.flow," ").concat(T?"playing":""),type:d.VOICE,width:16,height:16,onClick:y}),n("span",{children:"".concat(h,"s")})]})),n("audio",t({src:null==m?void 0:m.url,ref:g,controls:!0,className:"message-audio-none"},{children:n("track",{kind:"captions"})})),f]}))}));function p(e){return n(m,t({},e))}export{p as MessageAudio};
