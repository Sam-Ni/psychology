import{__awaiter as e,__generator as t}from"tslib";import{useCallback as r}from"react";import{MESSAGE_FLOW as n,MESSAGE_OPERATE as o}from"../../../constants.js";import{useTUIKitContext as s}from"../../../context/TUIKitContext.js";import"../../../context/TUIChatStateContext.js";import{useTUIChatActionContext as a}from"../../../context/TUIChatActionContext.js";import"../../../context/TUIMessageContext.js";import"../../../context/ComponentContext.js";import"../../../context/TUIMessageInputContext.js";import{Toast as i}from"../../Toast/index.js";var u=function(u){var l=u.message,c=u.handleError,d=a(),v=d.removeMessage,f=d.editLocalmessage,m=d.operateMessage,p=d.revokeMessage,g=s("useDeleteHandler").tim,h=r((function(r){return e(void 0,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:if(r.preventDefault(),!(null==l?void 0:l.ID)||!g||!v)return[2];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,g.deleteMessage([l])];case 2:return t.sent(),v(l),[3,4];case 3:if(e=t.sent(),!c)throw i({text:"Error deleting message",type:"error"}),new Error(e);return c({functionName:"deleteMessage",error:e}),[3,4];case 4:return[2]}}))}))}),[l]),x=r((function(r){return e(void 0,void 0,void 0,(function(){var e,o;return t(this,(function(t){switch(t.label){case 0:if(r.preventDefault(),!(null==l?void 0:l.ID)||!g||!f)return[2];t.label=1;case 1:return t.trys.push([1,6,,7]),p?[4,p(l)]:[3,3];case 2:return t.sent(),[3,5];case 3:return[4,g.revokeMessage(l)];case 4:t.sent(),t.label=5;case 5:return f(l),[3,7];case 6:if(e=t.sent(),!c)throw o=l.flow===n.OUT?"The message recall exceeded the time limit (default 2 minutes)":"Error revoke Message",i({text:o,type:"error"}),new Error(e);return c({functionName:"revokeMessage",error:e}),[3,7];case 7:return[2]}}))}))}),[l]),M=r((function(e){var t;e.preventDefault(),(null==l?void 0:l.ID)&&g&&m&&m(((t={})[o.QUOTE]=l,t))}),[l]),y=r((function(e){if(e.preventDefault(),navigator.clipboard)navigator.clipboard.writeText(l.payload.text);else{var t=document.createElement("textarea");document.body.appendChild(t),t.style.position="fixed",t.style.clip="rect(0 0 0 0)",t.style.top="10px",t.value=l.payload.text,t.select(),document.execCommand("copy",!0),document.body.removeChild(t)}}),[l]),C=r((function(r){return e(void 0,void 0,void 0,(function(){var e,r,n;return t(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,g.resendMessage(l)];case 1:return e=t.sent(),f(null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.message),[3,3];case 2:if(r=t.sent(),!c)throw i({text:r,type:"error"}),new Error(r);return c({functionName:"resendMessage",error:r}),[3,3];case 3:return[2]}}))}))}),[l]),D=r((function(r){return e(void 0,void 0,void 0,(function(){var e;return t(this,(function(t){return r.preventDefault(),(null==l?void 0:l.ID)&&g&&m?(m(((e={})[o.FORWARD]=l,e)),[2]):[2]}))}))}),[l]);return{handleDelMessage:h,handleRevokeMessage:x,handleReplyMessage:M,handleCopyMessage:y,handleResendMessage:C,handleForWardMessage:D}};export{u as useMessageHandler};
