import{__awaiter as e,__generator as t,__assign as i}from"tslib";import{jsxs as s,jsx as o}from"react/jsx-runtime";import n,{useState as l,useEffect as r}from"react";import"../../context/TUIKitContext.js";import{useTUIChatStateContext as a}from"../../context/TUIChatStateContext.js";import{useTUIChatActionContext as c}from"../../context/TUIChatActionContext.js";import"../../context/TUIMessageContext.js";import{useComponentContext as m}from"../../context/ComponentContext.js";import"../../context/TUIMessageInputContext.js";import d from"./hooks/useEnrichedMessageList.js";import g from"./hooks/useMessageListElement.js";import{InfiniteScroll as h}from"../InfiniteScrollPaginator/InfiniteScroll.js";import{EmptyStateIndicator as u}from"../EmptyStateIndicator/EmptyStateIndicator.js";var f=n.memo((function(n){var f=this,v=n.messageList,p=n.highlightedMessageId,I=n.loadMore,M=n.intervalsTimer,T=n.className,x=l(null),L=x[0],j=x[1],C=l(!1),U=C[0],S=C[1],E=a("TUIMessageList"),b=E.messageList,y=E.highlightedMessageId,N=E.isCompleted,k=E.isSameLastMessageID,w=E.messageListRef,H=E.noMore,V=E.TUIMessageListConfig,q=c(),A=q.loadMore,D=q.setHighlightedMessageId,K=m(),P=K.TUIMessage,R=K.EmptyStateIndicator,z=void 0===R?u:R,B=p||(null==V?void 0:V.highlightedMessageId)||y,F=60*(M||(null==V?void 0:V.intervalsTimer)||30),G=d({messageList:v||(null==V?void 0:V.messageList)||b}).messageList,J=I||(null==V?void 0:V.loadMore)||A,O=g({enrichedMessageList:G,TUIMessage:P,intervalsTimer:F});return r((function(){e(f,void 0,void 0,(function(){var e,i,s,o,n;return t(this,(function(t){switch(t.label){case 0:return e=null===(n=null==L?void 0:L.parentElement)||void 0===n?void 0:n.parentElement,!N&&(null==e?void 0:e.clientHeight)>=(null==L?void 0:L.clientHeight)?[4,J()]:[3,2];case 1:t.sent(),t.label=2;case 2:return!(null==L?void 0:L.children)||U&&k||(i=(null==L?void 0:L.children)||[],s=i[i.length-1],o=setTimeout((function(){null==s||s.scrollIntoView({block:"end"}),S(!0),clearTimeout(o)}),100)),[2]}}))}))}),[O,U]),r((function(){if(B){var e=null==L?void 0:L.querySelector("[data-message-id='".concat(B,"']"));if(!e)return;var t=e.children[1].children;t[t.length-1].classList.add("high-lighted"),null==e||e.scrollIntoView({block:"center"});var i=setTimeout((function(){t[t.length-1].classList.remove("high-lighted"),clearTimeout(i),D("")}),1e3)}}),[B]),s("div",i({className:"message-list ".concat(T," ").concat(U?"":"hide"),ref:w},{children:[H,H&&o("p",i({className:"no-more"},{children:"No More"})),o(h,i({className:"message-list-infinite-scroll",hasMore:!0,loadMore:J,threshold:1},{children:o("ul",i({ref:j},{children:(null==O?void 0:O.length)>0?O:o(z,{listType:"message"})}))}))]}))}));function v(e){return o(f,i({},e))}export{v as TUIMessageList};
