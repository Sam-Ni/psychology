import{__awaiter as t,__generator as e}from"tslib";import{useCallback as n}from"react";import{CONSTANT_DISPATCH_TYPE as o,MESSAGE_TYPE_NAME as r,MESSAGE_OPERATE as a}from"../../../constants.js";import{useTUIKitContext as s}from"../../../context/TUIKitContext.js";import"../../../context/TUIChatStateContext.js";import{useTUIChatActionContext as i}from"../../../context/TUIChatActionContext.js";import"../../../context/TUIMessageContext.js";import"../../../context/ComponentContext.js";import"../../../context/TUIMessageInputContext.js";import{formatEmojiString as u}from"../../TUIMessage/utils/emojiMap.js";import{useHandleQuoteMessage as c}from"./useHandleQuoteMessage.js";var l=function(l){var f=l.state,d=l.dispatch;l.focus;var p=l.textareaRef,T=l.sendUploadMessage,m=s("useMessageInputText").tim,v=i(),x=v.sendMessage,g=v.createTextMessage,y=v.operateMessage,E=c().cloudCustomData,C=["Enter","NumpadEnter"],S=n((function(t){t.preventDefault(),t&&t.target&&d({type:o.SET_TEXT,getNewText:function(e){return t.target.value}})}),[m]),h=function(n){return t(void 0,void 0,void 0,(function(){var t,r,s;return e(this,(function(e){switch(e.label){case 0:return null==n||n.preventDefault(),f.text?(t={payload:{text:u(f.text)}},E.messageReply&&(t.cloudCustomData=JSON.stringify(E)),r=g(t),[4,x(r)]):[2];case 1:return e.sent(),d({getNewText:function(t){return""},type:o.SET_TEXT}),y(((s={})[a.QUOTE]=null,s)),[2]}}))}))},M=n((function(t){!(null==t?void 0:t.ctrlKey)&&C.indexOf(null==t?void 0:t.code)>-1&&13===t.keyCode&&(null==t||t.preventDefault(),h(t)),(null==t?void 0:t.ctrlKey)&&C.indexOf(null==t?void 0:t.code)>-1&&13===t.keyCode&&d({type:o.SET_TEXT,getNewText:function(t){return"".concat(t,"\n")}})}),[h,d]),j=n((function(n){return t(void 0,void 0,void 0,(function(){var t,a,s;return e(this,(function(e){return n.preventDefault(),n.clipboardData&&n.clipboardData.items?(t=n.clipboardData,a=t.types,s=t.items,a.find((function(t,e){var n=s[e];switch(t){case"text/plain":return n.getAsString((function(t){d({type:o.SET_TEXT,getNewText:function(e){return"".concat(e).concat(t)}})})),!0;case"Files":var a=n.getAsFile();return n&&"file"===n.kind&&n.type.match(/^image\//i)&&T({file:a},r.IMAGE),!0;default:return!1}})),[2]):[2]}))}))}),[p]),D=n((function(t){var e;d({type:o.SET_TEXT,getNewText:function(e){return"".concat(e.slice(0,f.cursorPos.start)).concat(t).concat(e.slice(f.cursorPos.start))}}),d({type:o.SET_CURSOR_POS,value:{start:f.cursorPos.start+t.length,end:f.cursorPos.end+t.length}}),null===(e=null==p?void 0:p.current)||void 0===e||e.focus()}),[p,f]),U=n((function(t){var e;d({type:o.SET_TEXT,getNewText:function(){return"".concat(t)}}),null===(e=null==p?void 0:p.current)||void 0===e||e.focus()}),[p]),_=n((function(t){d({type:o.SET_CURSOR_POS,value:t})}),[p]);return{handleChange:S,handleSubmit:h,handleKeyDown:M,handlePasete:j,insertText:D,setText:U,setCursorPos:_}};export{l as useMessageInputText};
